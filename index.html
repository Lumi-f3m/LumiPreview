<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozy HTML Previewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&display=swap" rel="stylesheet">
    <style>
        /* Custom styles to ensure Bubblegum Sans font is applied and body takes full height */
        body {
            font-family: 'Bubblegum Sans', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to bottom right, #FFF8E1, #FFECB3); /* Soft, creamy gradient */
            overflow: hidden;
            transition: background-color 0.3s ease;
        }

        /* Dark mode styles for the body */
        body.dark-mode {
            background: linear-gradient(to bottom right, #4E342E, #2A1E1C); /* Warm, dark gradient */
            color: #F5F5DC;
        }

        /* Ensure the iframe fills its container */
        #previewFrame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Specific styles for the minimized state */
        #previewWindow.minimized {
            height: 48px;
            overflow: hidden;
            resize: none;
        }

        /* Specific styles for the maximized state */
        #previewWindow.maximized {
            width: 100vw;
            height: 100vh;
            left: 0;
            top: 0;
            border-radius: 0;
            transform: none;
        }

        /* Dark mode styles for the window itself */
        .dark-mode #previewWindow {
            background-color: #6D4C41;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
        }

        /* Dark mode styles for input/textarea */
        .dark-mode #htmlInput,
        .dark-mode #previewFrame {
            background-color: #5D4037;
            border-color: #5D4037;
            color: #F5F5DC;
        }

        /* Dark mode styles for labels */
        .dark-mode label,
        .dark-mode h3 {
            color: #D7CCC8;
        }

        /* Styles for the custom message box */
        #messageBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #FFFDE7;
            padding: 20px;
            border-radius: 16px; /* Increased rounded corners */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            text-align: center;
            font-family: 'Bubblegum Sans', sans-serif;
            color: #424242;
        }

        #messageBox.dark-mode {
            background-color: #6D4C41;
            color: #D7CCC8;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        #messageBox button {
            margin-top: 15px;
            background-color: #FFAB91; /* Soft coral */
            color: white;
            padding: 8px 16px;
            border-radius: 12px; /* Rounded button corners */
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #messageBox button:hover {
            background-color: #FF8A65; /* Darker coral on hover */
        }
    </style>
</head>
<body>

    <button
        id="darkModeToggle"
        class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-[#FFECB3] hover:bg-[#FFD54F] text-[#424242] font-bold py-2 px-4 rounded-full shadow-md transition-all duration-200 ease-in-out transform hover:scale-105 flex items-center z-50
               dark:bg-[#2A1E1C] dark:hover:bg-[#4E342E] dark:text-[#F5F5DC]"
    >
        <span id="sunEmoji" class="text-xl">‚òÄÔ∏è</span>
        <span id="moonEmoji" class="text-xl hidden">üåô</span>
        <span id="darkModeText" class="ml-2">Toggle Dark Mode</span>
    </button>

    <div
        id="previewWindow"
        class="absolute bg-[#FFFDE7] rounded-3xl shadow-2xl overflow-hidden flex flex-col transition-all duration-300 ease-in-out"
        style="
            width: 600px;
            height: 450px;
            left: 50px;
            top: 50px;
        "
    >
        <div
            id="windowHeader"
            class="flex items-center justify-between bg-gradient-to-r from-[#FFAB91] to-[#FFCC80] text-white p-3 cursor-grab active:cursor-grabbing rounded-t-3xl"
        >
            <div class="flex space-x-2 mr-4">
                <button id="closeBtn" class="w-5 h-5 bg-[#EF5350] hover:bg-[#E57373] rounded-full transition-colors flex items-center justify-center group text-white">
                    <span class="opacity-0 group-hover:opacity-100 transition-opacity">‚ùå</span>
                </button>
                <button id="minimizeBtn" class="w-5 h-5 bg-[#FFEE58] hover:bg-[#FFD54F] rounded-full transition-colors flex items-center justify-center group text-white">
                    <span class="opacity-0 group-hover:opacity-100 transition-opacity">‚ûñ</span>
                </button>
                <button id="maximizeBtn" class="w-5 h-5 bg-[#66BB6A] hover:bg-[#A5D6A7] rounded-full transition-colors flex items-center justify-center group text-white">
                    <span class="opacity-0 group-hover:opacity-100 transition-opacity">‚ûï</span>
                </button>
            </div>
            <span class="text-xl font-semibold flex items-center mx-auto text-[#424242]">
                <span class="mr-2">üêæ</span> HTML Previewer
            </span>
        </div>

        <div class="flex flex-1 p-4 overflow-hidden">
            <div class="flex flex-col w-1/2 pr-4">
                <label for="htmlInput" class="block text-[#424242] text-lg font-bold mb-2">
                    Enter HTML or choose a file:
                </label>
                <textarea
                    id="htmlInput"
                    class="flex-1 p-3 border border-[#FFD54F] rounded-2xl focus:outline-none focus:ring-2 focus:ring-[#FF8A65] font-mono text-sm resize-none mb-3 shadow-inner"
                    placeholder=" "
                ></textarea>
                <div class="flex items-center space-x-3 mb-3">
                    <label class="cursor-pointer bg-[#90CAF9] hover:bg-[#64B5F6] text-white font-bold py-2 px-4 rounded-xl shadow-md transition-all duration-200 ease-in-out transform hover:scale-105">
                        Choose File
                        <input type="file" id="fileInput" accept=".html,.htm" class="hidden" />
                    </label>
                    <button
                        id="previewButton"
                        class="bg-[#AED581] hover:bg-[#81C784] text-white font-bold py-2 px-4 rounded-xl shadow-md transition-all duration-200 ease-in-out transform hover:scale-105 flex items-center"
                    >
                        <span class="mr-2">‚ñ∂Ô∏è</span>
                        Preview HTML
                    </button>
                </div>
            </div>

            <div class="flex flex-col w-1/2 pl-4 border-l border-[#FFD54F]">
                <h3 class="text-[#424242] text-lg font-bold mb-2">Live Preview:</h3>
                <iframe
                    id="previewFrame"
                    class="flex-1 border border-[#FFD54F] rounded-2xl bg-white shadow-inner mb-3"
                    title="HTML Preview"
                    sandbox="allow-scripts allow-same-origin"
                    srcdoc="<p style='font-family: Bubblegum Sans, sans-serif; padding: 10px; color: #424242;'>Your HTML will appear here...</p>"
                ></iframe>
                <div class="flex flex-col space-y-2">
                    <button
                        id="openAboutBlankBtn"
                        class="bg-[#FFD54F] hover:bg-[#FFCC80] text-white font-bold py-2 px-4 rounded-xl shadow-md transition-all duration-200 ease-in-out transform hover:scale-105 flex items-center justify-center"
                    >
                        <span class="mr-2">üö™</span>
                        Open in about:blank
                    </button>
                    <button
                        id="openFullscreenBtn"
                        class="bg-[#FFAB91] hover:bg-[#FF8A65] text-white font-bold py-2 px-4 rounded-xl shadow-md transition-all duration-200 ease-in-out transform hover:scale-105 flex items-center justify-center"
                    >
                        <span class="mr-2">üñºÔ∏è</span>
                        Open in new Tab
                    </button>
                </div>
            </div>
        </div>

        <div
            id="resizeHandle"
            class="absolute bottom-0 right-0 w-6 h-6 bg-[#FFD54F] hover:bg-[#FFCC80] cursor-nwse-resize rounded-br-3xl"
        ></div>
    </div>

    <div id="messageBox">
        <p>To bring back the page, refresh the page!</p>
        <button id="closeMessageBox">Got it!</button>
    </div>

    <script>
        // Get references to DOM elements
        const body = document.body;
        const previewWindow = document.getElementById('previewWindow');
        const windowHeader = document.getElementById('windowHeader');
        const htmlInput = document.getElementById('htmlInput');
        const fileInput = document.getElementById('fileInput');
        const previewButton = document.getElementById('previewButton');
        const previewFrame = document.getElementById('previewFrame');
        const resizeHandle = document.getElementById('resizeHandle');

        // New preview option buttons
        const openAboutBlankBtn = document.getElementById('openAboutBlankBtn');
        const openFullscreenBtn = document.getElementById('openFullscreenBtn');

        // MacBook OS-like control buttons
        const closeBtn = document.getElementById('closeBtn');
        const minimizeBtn = document.getElementById('minimizeBtn');
        const maximizeBtn = document.getElementById('maximizeBtn');

        // Dark mode toggle button and its emojis/text
        const darkModeToggle = document.getElementById('darkModeToggle');
        const sunEmoji = document.getElementById('sunEmoji');
        const moonEmoji = document.getElementById('moonEmoji');
        const darkModeText = document.getElementById('darkModeText');

        // Message box elements
        const messageBox = document.getElementById('messageBox');
        const closeMessageBoxBtn = document.getElementById('closeMessageBox');


        // Variables for dragging functionality
        let isDragging = false;
        let dragOffsetX, dragOffsetY;

        // Variables for resizing functionality
        let isResizing = false;
        let resizeStartX, resizeStartY;
        let originalWidth, originalHeight;

        // Variables for window state (minimize/maximize)
        let isMinimized = false;
        let isMaximized = false;
        let originalWindowRect = {};

        // --- Draggable Window Logic ---
        windowHeader.addEventListener('mousedown', (e) => {
            if (!isMaximized && (e.target === windowHeader || e.target.closest('#windowHeader') === windowHeader)) {
                isDragging = true;
                dragOffsetX = e.clientX - previewWindow.offsetLeft;
                dragOffsetY = e.clientY - previewWindow.offsetTop;
                windowHeader.classList.add('active:cursor-grabbing');
            }
        });

        // --- Mouse move event for dragging and resizing ---
        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                let newX = e.clientX - dragOffsetX;
                let newY = e.clientY - dragOffsetY;
                previewWindow.style.left = `${newX}px`;
                previewWindow.style.top = `${newY}px`;
            } else if (isResizing) {
                const deltaX = e.clientX - resizeStartX;
                const deltaY = e.clientY - resizeStartY;

                const newWidth = Math.max(300, originalWidth + deltaX);
                const newHeight = Math.max(200, originalHeight + deltaY);

                previewWindow.style.width = `${newWidth}px`;
                previewWindow.style.height = `${newHeight}px`;
            }
        });

        // --- Mouse up event to stop dragging/resizing ---
        document.addEventListener('mouseup', () => {
            isDragging = false;
            isResizing = false;
            windowHeader.classList.remove('active:cursor-grabbing');
        });

        // --- Resizable Window Logic ---
        resizeHandle.addEventListener('mousedown', (e) => {
            e.stopPropagation();
            if (!isMaximized) {
                isResizing = true;
                resizeStartX = e.clientX;
                resizeStartY = e.clientY;
                originalWidth = previewWindow.offsetWidth;
                originalHeight = previewWindow.offsetHeight;
            }
        });

        // --- HTML Input and Preview Logic ---
        function updateIframeContent(htmlString) {
            const isDarkModeActive = body.classList.contains('dark-mode');

            // Basic dark mode styles to inject into the iframe
            const iframeDarkModeStyles = isDarkModeActive ? `
                body {
                    background-color: #2A1E1C !important;
                    color: #F5F5DC !important;
                }
                h1, h2, h3, h4, h5, h6 {
                    color: #F5F5DC !important;
                }
                p, span, div {
                    color: #D7CCC8 !important;
                }
                a {
                    color: #FFD54F !important;
                }
            ` : '';

            const fullHtml = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Preview</title>
                    <style>
                        body { margin: 0; padding: 10px; font-family: 'Bubblegum Sans', sans-serif; box-sizing: border-box; }
                        ${iframeDarkModeStyles}
                    </style>
                </head>
                <body>
                    ${htmlString}
                </body>
                </html>
            `;
            previewFrame.srcdoc = fullHtml;
        }

        previewButton.addEventListener('click', () => {
            updateIframeContent(htmlInput.value);
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    htmlInput.value = event.target.result;
                    updateIframeContent(event.target.result);
                };
                reader.readAsText(file);
            }
        });

        // --- New Preview Options Logic ---
        openAboutBlankBtn.addEventListener('click', () => {
            const newWindow = window.open('about:blank', '_blank');
            if (newWindow) {
                newWindow.document.write(previewFrame.srcdoc);
                newWindow.document.close();
            } else {
                console.error("Popup blocked.");
            }
        });

        openFullscreenBtn.addEventListener('click', () => {
            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(previewFrame.srcdoc);
                newWindow.document.close();
            } else {
                console.error("Popup blocked.");
            }
        });


        // --- macOS Button Functionality ---
        closeBtn.addEventListener('click', () => {
            previewWindow.style.display = 'none';
            messageBox.style.display = 'block';
            if (body.classList.contains('dark-mode')) {
                messageBox.classList.add('dark-mode');
            } else {
                messageBox.classList.remove('dark-mode');
            }
        });

        closeMessageBoxBtn.addEventListener('click', () => {
            messageBox.style.display = 'none';
        });

        // Minimize Button (Yellow)
        minimizeBtn.addEventListener('click', () => {
            if (isMaximized) {
                maximizeBtn.click();
            }

            if (!isMinimized) {
                originalWindowRect.height = previewWindow.offsetHeight;
                previewWindow.classList.add('minimized');
                isMinimized = true;
                resizeHandle.style.display = 'none';
            } else {
                previewWindow.style.height = `${originalWindowRect.height}px`;
                previewWindow.classList.remove('minimized');
                isMinimized = false;
                resizeHandle.style.display = 'block';
            }
        });

        // Maximize Button (Green)
        maximizeBtn.addEventListener('click', () => {
            if (isMinimized) {
                minimizeBtn.click();
            }

            if (!isMaximized) {
                originalWindowRect = {
                    left: previewWindow.offsetLeft,
                    top: previewWindow.offsetTop,
                    width: previewWindow.offsetWidth,
                    height: previewWindow.offsetHeight,
                };
                previewWindow.classList.add('maximized');
                isMaximized = true;
                resizeHandle.style.display = 'none';
                windowHeader.style.cursor = 'default';
            } else {
                previewWindow.style.left = `${originalWindowRect.left}px`;
                previewWindow.style.top = `${originalWindowRect.top}px`;
                previewWindow.style.width = `${originalWindowRect.width}px`;
                previewWindow.style.height = `${originalWindowRect.height}px`;
                previewWindow.classList.remove('maximized');
                isMaximized = false;
                resizeHandle.style.display = 'block';
                windowHeader.style.cursor = 'grab';
            }
        });

        // --- Dark Mode Toggle Logic ---
        darkModeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            if (body.classList.contains('dark-mode')) {
                sunEmoji.classList.add('hidden');
                moonEmoji.classList.remove('hidden');
                darkModeText.textContent = 'Toggle Light Mode';
            } else {
                sunEmoji.classList.remove('hidden');
                moonEmoji.classList.add('hidden');
                darkModeText.textContent = 'Toggle Dark Mode';
            }
            updateIframeContent(htmlInput.value);
        });

        // Initial preview when the page loads
        window.onload = () => {
            updateIframeContent(htmlInput.value);
        };
    </script>
</body>
</html>

